<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">


    <title>Bohyung</title>
    <script>
  		function getUrlParameter(query, name) {
  			//console.log("getParameter: "+query)
  			if (query != null && query.charAt(0) != '?') {
  				query = '?' + query
  			}
  		    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
  		    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
  		    var results = regex.exec(query);
  			return results === null ? '' : results[1].replace(/\+/g, ' ');
  		};

  		function getDecodedUrlParameter(query, name) {
  			//console.log("getDecodedUrlParameter: "+query)
  			if (query != null && query.charAt(0) != '?') {
  				query = '?' + query
  			}

  		    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
  		    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
  		    var results = regex.exec(query);
  		    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
  		};

  		function process_referrer() {
  			// 안드로이드앱 구글 플레이 주소
  			base_google_play_url = 'https://play.google.com/store/apps/details?id=com.hellochatty'
  			// 딥링크 샘플 (랜덥채팅)
  			base_deeplink = 'hellochatty://hellochatty.co/chat'

  			// TUNE에서 리다이렉트시 추가한 referrer. mat_click_id가 URL 인코딩되어 있음.
  			referrer = getUrlParameter(location.search, 'referrer');
  			// TUNE에서 리다이렉트시 추가한 referrer를 디코딩
  			decoded_referrer = getDecodedUrlParameter(location.search, 'referrer');
  			// TUNE에서 리다이렉트시 추가한 referrer에서 mat_click_id 추출
  			mat_click_id = getDecodedUrlParameter(decoded_referrer, 'mat_click_id');

  			// 앱 딥링크의 쿼리파라메터에 mat_click_id 추가 해서 딥링킹
  			if (mat_click_id.length > 0) {
          my_char = '';
          if (base_deeplink.indexOf('?') == -1) {
            my_char = '?';
          } else {
            my_char = '&';
          }
  				final_deeplink = base_deeplink + my_char + 'mat_click_id='+mat_click_id;
  			} else {
  				final_deeplink = base_deeplink
  			}
  			// 안드로이드 앱을 구글 플레이로 리다이렉트시
  			// 1. 허브페이지 랜딩시 추가된 referrer를 이후 다른 페이지로 추가 리다이렉트 될 경우에도 계속 가지고 있다가 최종적으로 구글 플레이 랜딩시 쿼리 파라메터에 referrer를 추가함
  			// 2. 해당페이지에서 실행할 딥링크에 mat_click_id를 추가한뒤, URL인코딩한후 url 쿼리파라메터를 추가. (단순 메인페이지 실행이 아닌 디퍼드 딥링킹을 하기 위함)
  			// iOS앱은 특별한 처리 없이 마켓 주소로 그냥 랜딩
  			if (referrer.length > 0) {
  				final_google_play_url = base_google_play_url + '&referrer=' + referrer;
  				final_google_play_url_with_deferred_deeplink = base_google_play_url + '&referrer=' + referrer + '&url=' + encodeURIComponent(final_deeplink);
  			} else {
  				final_google_play_url = base_google_play_url;
  				final_google_play_url_with_deferred_deeplink = base_google_play_url + '&url=' + encodeURIComponent(final_deeplink);
  			}
  		};

      function process_tune_link() {
        tune_link_org = document.getElementById('tune_link_org').value;

        var log = document.getElementById('log');
        log.innerHTML = '<b>Log</b>';
        log.innerHTML += '<br>'+tune_link_org+'';

      };


      function do_process() {

        process_tune_link();

        return;
        my_tune_link_org = document.getElementById('tune_link_org').value;

        // Market URL
        my_and_market_url = document.getElementById('and_market_url').value;
        // Destination URL
        my_and_dest_url = document.getElementById('and_dest_url').value;
        // Deep Link URL
        my_and_deep_link_url = document.getElementById('and_deep_link_url').value;

        gen_and_market_url= my_and_market_url + '&url=' + encodeURIComponent(my_and_deep_link_url);

        my_char = '';
        if (my_and_deep_link_url.indexOf('?') == -1) {
          my_char = '?';
        } else {
          my_char = '&';
        }

        gen_and_market_url_mat_click_id = my_and_market_url +
                                      '&referrer=mat_click_id%3D{click_id}' +
                                      '&url=' + encodeURIComponent(my_and_deep_link_url) +
                                      encodeURIComponent(my_char) + 'mat_click_id%3D{click_id}';


        gen_and_market_url_mat_tracking_id = my_and_market_url +
                                      '&referrer=mat_tracking_id%3D{tracking_id}' +
                                      '&url=' + encodeURIComponent(my_and_deep_link_url) +
                                      encodeURIComponent(my_char) + 'mat_tracking_id%3D{tracking_id}';


        tune_link = 'https://s9u-6.tlnk.io/serve?action=click&campaign_id_android=236537&campaign_id_ios=237906&publisher_id=174354&site_id_android=2385&site_id_ios=2962';
        //tune_link += '&url_android=' + encodeURIComponent(gen_market_url_tracking_id).replace("%7Btracking_id%7D", "{tracking_id}").replace("%257Btracking_id%257D", "{tracking_id}");

        tune_link_mat_click_id = tune_link + '&url_android=' + encodeURIComponent(gen_and_market_url_mat_click_id).replace("%7Bclick_id%7D", "{click_id}").replace("%257Bclick_id%257D", "{click_id}");
        tune_link_mat_tracking_id = tune_link + '&url_android=' + encodeURIComponent(gen_and_market_url_mat_tracking_id).replace("%7Btracking_id%7D", "{tracking_id}").replace("%257Btracking_id%257D", "{tracking_id}");

        var output = document.getElementById('my_ddl_url');
        output.innerHTML = '';
        output.innerHTML += '<br><b>'+my_and_market_url+'</b>';
        output.innerHTML += '<br><b>'+my_and_dest_url+'</b>';
        output.innerHTML += '<br><b>'+my_and_deep_link_url+'</b>';
        output.innerHTML += '<br><b>'+gen_and_market_url+'</b>';
        output.innerHTML += '<hr>';
        output.innerHTML += '<a href="'+ tune_link_mat_click_id +'">TUNE Link 랜딩 AOS&iOS click_id</a><br>';
        output.innerHTML += '<br><b>'+tune_link_mat_click_id+'</b>';
        output.innerHTML += '<hr>';
        output.innerHTML += '<a href="'+ tune_link_mat_tracking_id +'">TUNE Link 랜딩 AOS&iOS tracking_id</a><br>';
        output.innerHTML += '<br><b>'+tune_link_mat_tracking_id+'</b>';


      };

  	</script>

    </head>
      <body>
        <div id="siteInfo">
        Post-migration Compatible TUNE Link Generation<br>
        마이그레이션이후 호환 TUNE Link 생성<br>
        <hr>
        </div>
        <div>
          <label>TUNE Link</label><br>
          <input type="text" id="tune_link_org" value="https://s9u-6.tlnk.io/serve?action=click&campaign_id_android=236537&campaign_id_ios=237906&publisher_id=174354&site_id_android=2385&site_id_ios=2962&url_android=https%3A%2F%2Fbson-branch.github.io%2Fdocs%2Fguides%2Fmigration%2Fbridge%2Fbridge.html&url_ios=https%3A%2F%2Fbson-branch.github.io%2Fdocs%2Fguides%2Fmigration%2Fbridge%2Fbridge.html" size="256"/>
        </div>
        <hr>
        <div>
          <b>Android</b><br>
          <label>Google Play URL:</label><br>
          <input type="text" id="and_market_url" value="https://play.google.com/store/apps/details?id=com.hellochatty"/><br>
          <label>Destination URL:</label><br>
          <input type="text" id="and_dest_url" value="https://play.google.com/store/apps/details?id=com.hellochatty"/><br>
          <label>Deep Link URL:</label><br>
          <input type="email" id="and_deep_link_url" value="hellochatty://hellochatty.co/chat" />
        </div>
        <hr>
        <div>
          <b>iOS</b><br>
          <label>App Store URL:</label><br>
          <input type="text" id="ios_market_url" value="https://play.google.com/store/apps/details?id=com.hellochatty"/><br>
          <label>Destination URL:</label><br>
          <input type="text" id="ios_dest_url" value="https://play.google.com/store/apps/details?id=com.hellochatty"/><br>
          <label>Deep Link URL:</label><br>
          <input type="email" id="ios_deep_link_url" value="hellochatty://hellochatty.co/chat" />
        </div>
        <hr>
        <div>
          <b>Web</b><br>
          <label>Destination URL:</label><br>
          <input type="text" id="web_dest_url" value="https://landing.branch.io"/>
        </div>
        <hr>
        <form>
          <input type="button" onclick="do_process()"  value="Generate" />
        </form>
        <div id="my_ddl_url">
        </div>
        <hr>
        <hr>
        <div id="log">
        </div>

  </body>
</html>
